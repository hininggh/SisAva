{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>Gerenciar Logs</h1>

<!-- Formulário de Filtragem -->
<form method="get" action="{% url 'filtrar_logs' %}">
    <label for="cursos">Cursos:</label>
    <select name="cursos" multiple>
        {% for curso in cursos_usuario %}
            <option value="{{ curso.id }}">{{ curso.nome }}</option>
        {% endfor %}
    </select>

    <label for="acoes">Ações:</label>
    <select name="acoes" multiple>
        {% for id, nome in acoes_choices %}
            <option value="{{ id }}">{{ nome }}</option>
        {% endfor %}
    </select>

    <label for="data_inicio">Data Início:</label>
    <input type="date" name="data_inicio">

    <label for="data_fim">Data Fim:</label>
    <input type="date" name="data_fim">

    <button type="submit" name="Filtrar">Filtrar</button>
</form>

<!-- Exibição dos Logs em uma Tabela -->
{% if logs %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Data e Hora</th>
                <th>Usuário</th>
                <th>Curso</th>
                <th>Ação</th>
                <th>Visitante</th>
                <th>Indicador</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
                <tr>
                    <td>{{ log.data_hora }}</td>
                    <td>{{ log.usuario }}</td>
                    <td>{{ log.curso }}</td>
                    <td>{{ log.acao }}</td>
                    <td>{{ log.visitante }}</td>
                    <td>{{ log.indicador }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Paginação -->
    <div class="pagination">
        {% if logs_page.has_previous %}
            <a href="?page=1">&laquo; Primeira</a>
            <a href="?page={{ logs_page.previous_page_number }}">&lsaquo; Anterior</a>
        {% endif %}

        <span>Página {{ logs_page.number }} de {{ logs_page.paginator.num_pages }}</span>

        {% if logs_page.has_next %}
            <a href="?page={{ logs_page.next_page_number }}">Próxima &rsaquo;</a>
            <a href="?page={{ logs_page.paginator.num_pages }}">Última &raquo;</a>
        {% endif %}
    </div>
{% else %}
    <p>Nenhum log encontrado.</p>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Dispara a filtragem automaticamente se necessário
        const urlParams = new URLSearchParams(window.location.search);
        if (!urlParams.has('cursos') && !urlParams.has('acoes') && !urlParams.has('data_inicio') && !urlParams.has('data_fim')) {
            // Se não houver parâmetros de filtragem, não carregue logs
            // Apenas mantenha os seletores disponíveis
        }
    });
</script>
{% endblock %}
