{% extends 'base.html' %}

{% block title %}Cadastro de Visitante{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center">{% if visitante %}Editar Visitante{% else %}Cadastrar Visitante{% endif %}</h2>


    <form method="post" id="visitanteForm">
        {% csrf_token %}

        <!-- Exibe os campos do formulário de forma organizada -->
        <div id="formulario-principal">
            <div class="form-group">
                {{ form.nome.label_tag }}
                {{ form.nome }}
                {% if form.nome.errors %}
                    <div class="text-danger">{{ form.nome.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.instituicao.label_tag }}
                {{ form.instituicao }}
                {% if form.instituicao.errors %}
                    <div class="text-danger">{{ form.instituicao.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.data_inicial.label_tag }}
                <input type="date" name="{{ form.data_inicial.name }}" class="form-control w-100" id="{{ form.data_inicial.id_for_label }}" value="{{ data_inicial }}">
                {% if form.data_inicial.errors %}
                    <div class="text-danger">{{ form.data_inicial.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.data_final.label_tag }}
                <input type="date" name="{{ form.data_final.name }}" class="form-control w-100" id="{{ form.data_final.id_for_label }}" value="{{ data_final }}">
                {% if form.data_final.errors %}
                    <div class="text-danger">{{ form.data_final.errors }}</div>
                {% endif %}
            </div>
            <div class="form-group">
                {{ form.email.label_tag }}
                {{ form.email }}
                {% if form.email.errors %}
                    <div class="text-danger">{{ form.email.errors }}</div>
                {% endif %}
            </div>

            <!-- Exibe campos de senha e confirmação de senha somente no cadastro -->
            {% if not visitante %}
                <div class="form-group">
                    {{ form.senha.label_tag }}
                    {{ form.senha }}
                    {% if form.senha.errors %}
                        <div class="text-danger">{{ form.senha.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.confirmar_senha.label_tag }}
                    {{ form.confirmar_senha }}
                    {% if form.confirmar_senha.errors %}
                        <div class="text-danger">{{ form.confirmar_senha.errors }}</div>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Cursos com Acesso (somente para edição) -->
            {% if visitante %}
                <h3 class="mt-4">Cursos com Acesso</h3>
                {{ curso_form.cursos_acesso.label }}
                <div class="form-check">
                    {{ curso_form.cursos_acesso }}
                </div>
                {% if curso_form.cursos_acesso.errors %}
                    <div class="text-danger">{{ curso_form.cursos_acesso.errors }}</div>
                {% endif %}
            {% endif %}
        </div>

        <div class="text-center mt-4">
            <!-- Botão para Salvar Alterações -->
            <button type="submit" class="btn btn-primary">{% if visitante %}Salvar Alterações{% else %}Cadastrar{% endif %}</button>

            {% if visitante %}
                <!-- Botão para abrir o modal de alteração de senha no modo de edição -->
                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#alterarSenhaModal">
                    Alterar Senha
                </button>
            {% endif %}

            <a href="{% if curso_id %}{% url 'editar_curso' curso_id=curso_id %}{% else %}{% url 'gerenciarvisitantes' %}{% endif %}" class="btn btn-secondary">Cancelar</a>
        </div>
        {% if visitante %}
            <!-- Modal de Alteração de Senha -->
            <div class="modal fade" id="alterarSenhaModal" tabindex="-1" aria-labelledby="alterarSenhaModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="alterarSenhaModalLabel">Alterar Senha</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="novaSenha">Nova Senha</label>
                                <input type="password" name="senha" id="novaSenha" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="confirmarSenha">Confirmar Nova Senha</label>
                                <input type="password" name="confirmar_senha" id="confirmarSenha" class="form-control">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <!-- Botão para validar e submeter o formulário -->
                            <button type="button" class="btn btn-primary" onclick="validarSenha()">Salvar Nova Senha e Alterações</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </form>
</div>

<!-- Script JavaScript atualizado -->
    <script>




        function validarSenha() {
            const senha = document.getElementById('novaSenha').value;
            const confirmarSenha = document.getElementById('confirmarSenha').value;

            if (senha.trim() === "" || confirmarSenha.trim() === "") {
                alert('Por favor, preencha ambos os campos de senha.');
                return;
            }
            if (senha !== confirmarSenha) {
                alert('As senhas não coincidem.');
            } else {
                document.getElementById('visitanteForm').submit();
            }
        }


</script>
{% endblock %}
