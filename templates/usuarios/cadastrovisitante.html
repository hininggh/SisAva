{% extends 'base.html' %}

{% block title %}Cadastro de Visitante{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center">{% if visitante %}Editar Visitante{% else %}Cadastrar Visitante{% endif %}</h2>

    <form method="post">
        {% csrf_token %}

        {{ form.as_p }}  <!-- Exibe os campos do formulário de forma organizada -->

        <!-- Campos de Senha e Confirmação de Senha exibidos apenas no modo de cadastro -->
        {% if not visitante %}
            <div class="form-group">
                {{ form.senha.label_tag }}
                {{ form.senha }}
                {% if form.senha.errors %}
                    <div class="text-danger">{{ form.senha.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.confirmar_senha.label_tag }}
                {{ form.confirmar_senha }}
                {% if form.confirmar_senha.errors %}
                    <div class="text-danger">{{ form.confirmar_senha.errors }}</div>
                {% endif %}
            </div>
        {% endif %}

        <!-- Cursos com Acesso (somente para edição) -->
        {% if visitante %}
            <h3 class="mt-4">Cursos com Acesso</h3>
            {{ curso_form.cursos_acesso.label }}
            <div class="form-check">
                {{ curso_form.cursos_acesso }}
            </div>
            {% if curso_form.cursos_acesso.errors %}
                <div class="text-danger">{{ curso_form.cursos_acesso.errors }}</div>
            {% endif %}
        {% endif %}

        <div class="text-center mt-4">
            <!-- Botão para Salvar Alterações -->
            <button type="submit" class="btn btn-primary">{% if visitante %}Salvar Alterações{% else %}Cadastrar{% endif %}</button>

            <!-- Botão para abrir o modal de alteração de senha no modo de edição -->
            {% if visitante %}
                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#alterarSenhaModal">
                    Alterar Senha
                </button>
            {% endif %}

            <!-- Botão para Cancelar com redirecionamento condicional -->
            <a href="{% if curso_id %}{% url 'editar_curso' curso_id=curso_id %}{% else %}{% url 'gerenciarvisitantes' %}{% endif %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>

    <!-- Modal de Alteração de Senha (somente para edição) -->
    <div class="modal fade" id="alterarSenhaModal" tabindex="-1" aria-labelledby="alterarSenhaModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="alterarSenhaModalLabel">Alterar Senha</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="novaSenha">Nova Senha</label>
                        <input type="password" name="senha" id="novaSenha" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmarSenha">Confirmar Nova Senha</label>
                        <input type="password" name="confirmar_senha" id="confirmarSenha" class="form-control" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <!-- Botão para submeter o formulário com os dados do modal -->
                    <button type="button" class="btn btn-primary" onclick="document.querySelector('form').submit();">Salvar Nova Senha e Alterações</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('alterarSenhaModal').addEventListener('shown.bs.modal', function () {
    document.getElementById('novaSenha').focus();
});
</script>
{% endblock %}
