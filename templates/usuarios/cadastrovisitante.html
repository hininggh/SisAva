{% extends 'base.html' %}

{% block title %}Cadastro de Visitante{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center">{% if visitante %}Editar Visitante{% else %}Cadastrar Visitante{% endif %}</h2>

    <form method="post" id="visitanteForm">
        {% csrf_token %}

        <!-- Exibe os campos do formulário de forma organizada -->
        <div id="formulario-principal">
            <div class="form-group">
                {{ form.nome.label_tag }}
                {{ form.nome }}
                {% if form.nome.errors %}
                    <div class="text-danger">{{ form.nome.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.instituicao.label_tag }}
                {{ form.instituicao }}
                {% if form.instituicao.errors %}
                    <div class="text-danger">{{ form.instituicao.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.data_inicial.label_tag }}
                <input type="date" name="{{ form.data_inicial.name }}" class="form-control w-100" id="{{ form.data_inicial.id_for_label }}" value="{{ data_inicial }}">
                {% if form.data_inicial.errors %}
                    <div class="text-danger">{{ form.data_inicial.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.data_final.label_tag }}
                <input type="date" name="{{ form.data_final.name }}" class="form-control w-100" id="{{ form.data_final.id_for_label }}" value="{{ data_final }}">
                {% if form.data_final.errors %}
                    <div class="text-danger">{{ form.data_final.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.email.label_tag }}
                {{ form.email }}
                {% if form.email.errors %}
                    <div class="text-danger">{{ form.email.errors }}</div>
                {% endif %}
            </div>
            {% if visitante %}
            <!-- Botão para mostrar/ocultar a seção de senha -->
                <button type="button" class="btn btn-warning" onclick="toggleSenhaSection()">Alterar Senha</button>
            {% endif %}
            <!-- Seção de senha (inicialmente oculta) -->
            <div id="senhaSection" style="display: none; margin-top: 20px;">
                <div class="form-group">
                    {{ form.senha.label_tag }}
                    {{ form.senha }}
                    {% if form.senha.errors %}
                        <div class="text-danger">{{ form.senha.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.confirmar_senha.label_tag }}
                    {{ form.confirmar_senha }}
                    {% if form.confirmar_senha.errors %}
                        <div class="text-danger">{{ form.confirmar_senha.errors }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Cursos com Acesso (somente para edição) -->
            {% if visitante %}
                <h3 class="mt-4"></h3>
                {{ curso_form.cursos_acesso.label }}
                <div class="form-check">
                    {{ curso_form.cursos_acesso }}
                </div>
                {% if curso_form.cursos_acesso.errors %}
                    <div class="text-danger">{{ curso_form.cursos_acesso.errors }}</div>
                {% endif %}
            {% endif %}
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary">{% if visitante %}Salvar Alterações{% else %}Cadastrar{% endif %}</button>
            <a href="{% if curso_id %}{% url 'editar_curso' curso_id=curso_id %}{% else %}{% url 'gerenciarvisitantes' %}{% endif %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Verifica se a seção de senha deve ser mostrada
        const mostrarSessaoSenha = {{ mostrar_sessao_senha|yesno:"true,false" }};
        if (mostrarSessaoSenha === true) {  // Corrigido para comparação direta com true
            document.getElementById('senhaSection').style.display = 'block';
        }
    });

    // Função para mostrar ou ocultar a seção de senha
    function toggleSenhaSection() {
        const senhaSection = document.getElementById('senhaSection');
        if (senhaSection.style.display === 'none' || senhaSection.style.display === '') {
            senhaSection.style.display = 'block';
        } else {
            senhaSection.style.display = 'none';
        }
    }
</script>


{% endblock %}
